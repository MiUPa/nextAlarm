# Location Notifier

指定されたエリアでアプリを開いたらポップアップ通知が出るFlutterアプリ

## 機能

### 主要機能
- **エリア指定**: 緯度、経度、半径（メートル）で監視エリアを設定
- **位置情報モニタリング**: 5秒ごとに現在位置をチェック
- **ジオフェンシング**: 指定エリアに入ったことを自動検知
- **プッシュ通知**: エリアに入った瞬間に通知を表示

### シミュレート機能
実機やエミュレータで位置情報をシミュレートできます：
- 任意の緯度・経度を設定可能
- モニタリング中でもリアルタイムで位置を変更可能
- テストに最適

## スクリーンショット

アプリには以下の3つのセクションがあります：

1. **エリア設定**: 監視したいエリアの緯度、経度、半径を設定
2. **位置情報シミュレート**: テスト用に仮想の位置情報を設定（オレンジ色で表示）
3. **現在の状態**: モニタリング状態、現在位置、エリアまでの距離を表示

## スマホで今すぐ試す（最も簡単）

### Android APKをダウンロード

1. [GitHub Actions](https://github.com/MiUPa/Linux-Playground/actions)ページにアクセス
2. 最新の成功したワークフロー実行をクリック
3. 「Artifacts」セクションから `location-notifier-apk` をダウンロード
4. ZIPを解凍して `app-release.apk` を取得
5. スマホに転送してインストール

**注意**: 提供元不明のアプリのインストールを許可する必要があります。

## セットアップ（開発者向け）

### 前提条件

- Flutter SDK 3.10以上
- Android Studio（Android向け）または Xcode（iOS向け）
- Android SDK（Android向け）
- 実機またはエミュレータ

### インストール手順

1. リポジトリをクローン
```bash
git clone <repository-url>
cd location_notifier
```

2. 依存関係をインストール
```bash
flutter pub get
```

3. アプリを実行
```bash
# Android
flutter run

# iOS
flutter run
```

## 使い方

### 基本的な使い方

1. **エリアを設定**
   - 「エリア設定」セクションで緯度、経度、半径を入力
   - 「エリアを更新」ボタンをタップ

2. **モニタリングを開始**
   - 「モニタリングを開始」ボタンをタップ
   - 位置情報パーミッションを許可

3. **エリアに入る**
   - 指定したエリアに入ると自動的に通知が表示されます

### シミュレートモード（テスト用）

実際に移動せずにアプリをテストする方法：

1. **シミュレート位置を設定**
   - 「位置情報シミュレート」セクションで緯度、経度を入力
   - 「シミュレート開始」ボタンをタップ

2. **モニタリング中に位置を変更**
   - モニタリング中でも、シミュレート位置を変更できます
   - エリア内の座標を入力すると、すぐに通知が表示されます

3. **シミュレート解除**
   - 「シミュレート解除」ボタンで実際のGPS位置に戻ります

### 例：東京タワー付近をテスト

デフォルトエリアは東京タワー付近に設定されています：
- 緯度: 35.6586
- 経度: 139.7454
- 半径: 100メートル

シミュレートで東京タワーの座標（35.6586, 139.7454）を入力すると、エリア内通知が表示されます。

## パーミッション

### Android
以下のパーミッションが自動的に要求されます：
- `ACCESS_FINE_LOCATION`: 正確な位置情報
- `ACCESS_COARSE_LOCATION`: おおよその位置情報
- `ACCESS_BACKGROUND_LOCATION`: バックグラウンドでの位置情報
- `POST_NOTIFICATIONS`: 通知の表示

### iOS
以下の使用目的説明が表示されます：
- 「This app needs your location to send notifications when you enter specified areas.」

## 技術仕様

### 使用パッケージ
- `geolocator`: 位置情報の取得
- `flutter_local_notifications`: ローカル通知
- `permission_handler`: パーミッション管理

### ジオフェンシングアルゴリズム
Haversine公式を使用して2点間の距離を計算：
- 地球を球体として扱い、正確な距離を計算
- メートル単位で距離を返す

### モニタリング頻度
- 5秒ごとに位置情報をチェック
- エリアに入った瞬間（前回エリア外→今回エリア内）に通知

## トラブルシューティング

### 位置情報が取得できない
- 位置情報パーミッションが許可されているか確認
- GPS/位置情報サービスがオンになっているか確認
- エミュレータの場合、位置情報をモックで設定

### 通知が表示されない
- 通知パーミッションが許可されているか確認
- アプリがバックグラウンドではなくフォアグラウンドで実行されているか確認

### シミュレートが動作しない
- シミュレート位置を設定後、「シミュレート開始」ボタンをタップしたか確認
- モニタリングを再起動してみる

## 開発

### プロジェクト構造
```
lib/
  main.dart          # メインアプリケーションコード
android/
  app/src/main/
    AndroidManifest.xml  # Androidパーミッション設定
ios/
  Runner/
    Info.plist       # iOSパーミッション設定
```

### カスタマイズ

#### デフォルトエリアを変更
`lib/main.dart`の以下の行を編集：
```dart
double targetLatitude = 35.6586;   // あなたの緯度
double targetLongitude = 139.7454; // あなたの経度
double targetRadius = 100.0;       // 半径（メートル）
```

#### 通知メッセージを変更
`_showNotification()`メソッド内のテキストを編集：
```dart
await flutterLocalNotificationsPlugin.show(
  0,
  'エリア通知',                    // タイトル
  '指定されたエリアに入りました！',  // メッセージ
  platformChannelSpecifics,
);
```

#### モニタリング頻度を変更
`_startMonitoring()`メソッド内の秒数を変更：
```dart
locationTimer = Timer.periodic(const Duration(seconds: 5), (timer) {
  _getCurrentLocation();
});
```

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 貢献

プルリクエストを歓迎します！

## 作成者

Claude Code
