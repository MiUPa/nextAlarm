version: '3.8'
services:
  ubuntu-desktop:
    image: dorowu/ubuntu-desktop-lxde-vnc:latest  # 軽量デスクトップ（LXDE）付きUbuntu + VNC
    container_name: my-linux-vm
    ports:
      - "6080:80"  # noVNC（ブラウザアクセス用）
      - "5900:5900"  # VNC直接アクセス用（オプション）
    environment:
      - RESOLUTION=1920x1080  # 解像度設定（ゲーム用に高めに）
    volumes:
      - ./data:/home/ubuntu/data  # 永続化用ボリューム（ゲームデータ保存）
    devices:
      - /dev/dri:/dev/dri  # GPUアクセス（ゲーム用、MacのDocker Desktopで有効）
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia  # NVIDIA GPUの場合（Intel/M1 Macは不要）
              count: 1
              capabilities: [gpu]
    stdin_open: true
    tty: true
    command: |
      /bin/bash -c "
      apt update && apt install -y steam software-properties-common;
      echo 'Steam installed. Access via browser: http://localhost:6080';
      /usr/bin/supervisord -c /etc/supervisor/supervisord.conf
      "